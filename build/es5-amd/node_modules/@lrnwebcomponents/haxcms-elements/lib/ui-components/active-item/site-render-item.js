define(["exports","meta","require","../../../../../@polymer/polymer/polymer-element.js","../../../../../@polymer/polymer/lib/utils/resolve-url.js","../../../../../@polymer/polymer/lib/legacy/polymer.dom.js","../../../../../@polymer/polymer/lib/utils/async.js","../../core/haxcms-site-store.js","../../../../../@polymer/iron-ajax/iron-ajax.js","../../../../../mobx/lib/mobx.module.js"],function(_exports,meta,_require,_polymerElement,_resolveUrl,_polymerDom,_async,_haxcmsSiteStore,_ironAjax,_mobxModule){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.SiteRenderItem=void 0;meta=babelHelpers.interopRequireWildcard(meta);_require=babelHelpers.interopRequireWildcard(_require);function _templateObject_324cadd0540011e9ba54d9e10eb6add0(){var data=babelHelpers.taggedTemplateLiteral(["\n      <style>\n        :host {\n          display: block;\n        }\n      </style>\n      <iron-ajax\n        id=\"content\"\n        url=\"[[location]]\"\n        handle-as=\"text\"\n        loading=\"{{loading}}\"\n        debounce-duration=\"250\"\n        last-response=\"{{itemContent}}\"\n      ></iron-ajax>\n      <slot></slot>\n    "]);_templateObject_324cadd0540011e9ba54d9e10eb6add0=function(){return data};return data}var SiteRenderItem=function(_PolymerElement){babelHelpers.inherits(SiteRenderItem,_PolymerElement);function SiteRenderItem(){babelHelpers.classCallCheck(this,SiteRenderItem);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(SiteRenderItem).apply(this,arguments))}babelHelpers.createClass(SiteRenderItem,[{key:"_computeLocation",value:function _computeLocation(itemId,render){if(itemId&&render){var item=_haxcmsSiteStore.store.findItem(itemId);return item.location+"?"+Math.floor(Date.now()/1e3)}}},{key:"locationChanged",value:function locationChanged(newValue){if(newValue){this.$.content.generateRequest()}}},{key:"_itemContentChanged",value:function _itemContentChanged(newValue){var _this=this;if(newValue){var html=newValue;if(null!==html){html=this.encapScript(newValue);this.wipeSlot(this,"*");_async.microTask.run(function(){setTimeout(function(){var frag=document.createRange().createContextualFragment(html);(0,_polymerDom.dom)(_this).appendChild(frag)},5)});if(this.manifest.metadata.dynamicElementLoader){var i;(function(){var tagsFound=_this.findTagsInHTML(html),basePath=(0,_resolveUrl.pathFromUrl)(decodeURIComponent(meta.url)),_loop=function(){var tagName=tagsFound[i];if(_this.manifest.metadata.dynamicElementLoader[tagName]&&!window.customElements.get(tagName)){new Promise(function(res,rej){return _require.default(["".concat(basePath,"../../../../../").concat(_this.manifest.metadata.dynamicElementLoader[tagName])],res,rej)}).then(function(){}).catch(function(error){console.log(error)})}};for(i in tagsFound){_loop()}})()}}}}},{key:"findTagsInHTML",value:function findTagsInHTML(html){var tags={},tag="",matches=html.match(/<\/(\S*?)-(\S*?)>/g);for(var i in matches){tag=matches[i].replace("</","").replace(">","");tags[tag]=tag}return tags}},{key:"encapScript",value:function encapScript(html){html=html.replace(/<script[\s\S]*?>/gi,"&lt;script&gt;");html=html.replace(/<\/script>/gi,"&lt;/script&gt;");html=html.replace(/<style[\s\S]*?>/gi,"&lt;style&gt;");html=html.replace(/<\/style>/gi,"&lt;/style&gt;");html=html.replace(/<template[\s\S]*?>[\s\S]*?&lt;script[\s\S]*?&gt;[\s\S]*?&lt;\/script&gt;/gi,function(match){match=match.replace("&lt;script&gt;","<script>");match=match.replace("&lt;/script&gt;","</script>");match=match.replace("&lt;style&gt;","<style>");match=match.replace("&lt;/style&gt;","</style>");return match});return html}},{key:"wipeSlot",value:function wipeSlot(element){var slot=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"*";if("*"===slot){while(null!==(0,_polymerDom.dom)(element).firstChild){(0,_polymerDom.dom)(element).removeChild((0,_polymerDom.dom)(element).firstChild)}}else{for(var i in(0,_polymerDom.dom)(element).childNodes){if(babelHelpers.typeof((0,_polymerDom.dom)(element).childNodes[i])!=="undefined"&&(0,_polymerDom.dom)(element).childNodes[i].slot===slot){(0,_polymerDom.dom)(element).removeChild((0,_polymerDom.dom)(element).childNodes[i])}}}}},{key:"connectedCallback",value:function connectedCallback(){var _this2=this;babelHelpers.get(babelHelpers.getPrototypeOf(SiteRenderItem.prototype),"connectedCallback",this).call(this);this.__disposer=[];(0,_mobxModule.autorun)(function(reaction){_this2.manifest=(0,_mobxModule.toJS)(_haxcmsSiteStore.store.manifest);_this2.__disposer.push(reaction)})}},{key:"disconnectedCallback",value:function disconnectedCallback(){for(var i in this.__disposer){this.__disposer[i]}babelHelpers.get(babelHelpers.getPrototypeOf(SiteRenderItem.prototype),"disconnectedCallback",this).call(this)}}],[{key:"tag",get:function get(){return"site-render-item"}},{key:"template",get:function get(){return(0,_polymerElement.html)(_templateObject_324cadd0540011e9ba54d9e10eb6add0())}},{key:"properties",get:function get(){return{render:{type:Boolean,value:!1},itemId:{type:String},location:{type:String,computed:"_computeLocation(itemId, render)",observer:"locationChanged"},itemContent:{type:String,notify:!0,observer:"_itemContentChanged"}}}}]);return SiteRenderItem}(_polymerElement.PolymerElement);_exports.SiteRenderItem=SiteRenderItem;window.customElements.define(SiteRenderItem.tag,SiteRenderItem)});