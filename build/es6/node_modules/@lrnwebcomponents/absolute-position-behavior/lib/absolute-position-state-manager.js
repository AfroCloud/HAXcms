import{html,PolymerElement}from"../../../@polymer/polymer/polymer-element.js";import"../../../@polymer/iron-resizable-behavior/iron-resizable-behavior.js";import"../../es-global-bridge/es-global-bridge.js";import{pathFromUrl}from"../../../@polymer/polymer/lib/utils/resolve-url.js";window.AbsolutePositionStateManager=window.AbsolutePositionStateManager||{};window.AbsolutePositionStateManager.requestAvailability=()=>{if(!window.AbsolutePositionStateManager.instance){window.AbsolutePositionStateManager.instance=document.createElement("absolute-position-state-manager");document.body.appendChild(window.AbsolutePositionStateManager.instance)}return window.AbsolutePositionStateManager.instance};class AbsolutePositionStateManager extends PolymerElement{static get tag(){return"absolute-position-state-manager"}static get properties(){return{elements:{type:Array,value:[]}}}constructor(){super();this;if(!window.AbsolutePositionStateManager.instance){window.AbsolutePositionStateManager.instance=this;return this}}connectedCallback(){super.connectedCallback()}loadElement(el){let root=this;root.__on=root.__on!==void 0?root.__on:!1;root.elements.push(el);root.updatePosition(el);if(!root.__on)root.addEventListeners();root.__on=!0}unloadElement(el){let root=this;root.elements.filter(element=>element===el);root.__on=0<root.elements;if(!root.__on)root.removeEventListeners()}addEventListeners(){let root=this;root.__timeout=!1;root.updateElements();document.addEventListener("load",root.updateElements());window.addEventListener("resize",function(){clearTimeout(root.__timeout);root.__timeout=setTimeout(root.updateElements(),250)});root.__observer=new MutationObserver(function(){root.updateElements()});root.__observer.observe(document,{attributes:!0,childList:!0,subtree:!0,characterData:!0})}findTarget(el){var parentNode=el.parentNode,ownerRoot=el.shadowRoot,target;if(el.for){target=parentNode.querySelector("#"+el.for)}else{target=parentNode.nodeType==Node.DOCUMENT_FRAGMENT_NODE?ownerRoot.host:parentNode}return target}removeEventListeners(){let root=this;document.removeEventListener("load",root.updateElements());window.removeEventListener("resize",function(){clearTimeout(root.__timeout);root.__timeout=setTimeout(root.updateElements(),250)});root.__observer.disconnect()}updateElements(){let root=this;root.elements.forEach(element=>{root.updatePosition(element)})}updatePosition(element){var _Mathmax=Math.max;let target=this.findTarget(element);if(!target||!this.offsetParent)return;var offset=element.offset,parentRect=element.offsetParent.getBoundingClientRect(),targetRect=target.getBoundingClientRect(),elementRect=element.getBoundingClientRect(),horizontalCenterOffset=(targetRect.width-elementRect.width)/2,verticalCenterOffset=(targetRect.height-elementRect.height)/2,tooltipLeft,tooltipTop;switch(element.position){case"top":tooltipLeft=targetRect.left+horizontalCenterOffset;tooltipTop=targetRect.top-elementRect.height-offset;break;case"bottom":tooltipLeft=targetRect.left+horizontalCenterOffset;tooltipTop=targetRect.top+targetRect.height+offset;break;case"left":tooltipLeft=targetRect.left-elementRect.width-offset;tooltipTop=targetRect.top+verticalCenterOffset;break;case"right":tooltipLeft=targetRect.left+targetRect.width+offset;tooltipTop=targetRect.top+verticalCenterOffset;break;}element.style.position="absolute";if(element.fitToVisibleBounds){if(parentRect.left+tooltipLeft+elementRect.width>window.innerWidth){element.style.right="0px";element.style.left="auto"}else{element.style.left=_Mathmax(0,tooltipLeft)+"px";element.style.right="auto"}if(parentRect.top+tooltipTop+elementRect.height>window.innerHeight){element.style.bottom=parentRect.height-targetRect.top+offset+"px";element.style.top="auto"}else{element.style.top=_Mathmax(-parentRect.top,tooltipTop)+"px";element.style.bottom="auto"}}else{element.style.left=tooltipLeft+"px";element.style.top=tooltipTop+"px"}}disconnectedCallback(){super.disconnectedCallback();this.removeEventListeners()}}window.customElements.define(AbsolutePositionStateManager.tag,AbsolutePositionStateManager);export{AbsolutePositionStateManager};